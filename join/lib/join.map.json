{"version":3,"file":"bundle.js","sources":["/home/kriss/hg/js/join/node_modules/browserify/node_modules/browser-pack/_prelude.js","/home/kriss/hg/js/join/js/join.js"],"names":["ls","a","console","log","util","inspect","depth","exports","setup","opts","join","qs","window","location","href","slice","indexOf","split","i","length","q","decodeURIComponent","vars","session","$","cookie","token","userapi","template","fill","div","empty","append","find","clone","page","click","pagename","removeClass","addClass","val","name","email","pass","text","dumid","bind","callback","cmd","dat","error","cont","n","expires","path","S","command","submit","post","b","c","dumid_confirm","confirm","off","on","e","which","this","blur","load"],"mappings":"AAAA;ACCA,GAAIA,IAAG,SAASC,GAAKC,QAAQC,IAAIC,KAAKC,QAAQJ,GAAGK,MAAM,QAEvDC,SAAQC,MAAM,SAASC,GAEtB,GAAIC,IAAMD,KAAKA,EAKfC,GAAKC,KAEL,KAAI,GADAA,GAAGC,OAAOC,SAASC,KAAKC,MAAMH,OAAOC,SAASC,KAAKE,QAAQ,KAAO,GAAGC,MAAM,KACvEC,EAAI,EAAGA,EAAIP,EAAGQ,OAAQD,IAC9B,CACC,GAAIE,GAAET,EAAGO,GAAGD,MAAM,IAClBP,GAAKC,GAAIS,EAAE,IAAKC,mBAAmBD,EAAE,IAiQtC,MA9PAV,GAAKY,QACLZ,EAAKY,KAAKC,QAAQH,EAAEG,SAAWC,EAAEC,OAAO,eACxCf,EAAKY,KAAKI,MAAMN,EAAEM,MAYlBhB,EAAKiB,QAAQ,2CAGbjB,EAAKkB,SAASJ,EAAE,eAEhBd,EAAKmB,KAAK,WACTL,EAAEf,EAAKqB,KAAKC,QAAQC,OAAQtB,EAAKkB,SAASK,KAAK,iBAAiBC,SAG7DxB,EAAKC,GAAGe,OAEVhB,EAAKY,KAAKI,MAAMhB,EAAKC,GAAGe,MACxBhB,EAAKyB,KAAK,SACVX,EAAE,iCAAiCY,UAKnC1B,EAAKyB,KAAK,WACVX,EAAE,iCAAiCY,UAUrC1B,EAAKyB,KAAK,SAASE,GA4BlB,MA1BAb,GAAE,YAAYc,cAAcC,SAAS,wBAAwBF,GAE7D3B,EAAKY,KAAKI,MAAQF,EAAE,gCAAgCgB,OAAW9B,EAAKY,KAAKI,MACzEhB,EAAKY,KAAKmB,KAAQjB,EAAE,+BAAgCgB,OAAW9B,EAAKY,KAAKmB,KACzE/B,EAAKY,KAAKoB,MAAQlB,EAAE,gCAAgCgB,OAAW9B,EAAKY,KAAKoB,MACzEhC,EAAKY,KAAKqB,KAAQnB,EAAE,+BAAgCgB,OAAW9B,EAAKY,KAAKqB,KACzEjC,EAAKY,KAAKC,QAAQC,EAAE,kCAAkCgB,OAAS9B,EAAKY,KAAKC,QAEzEC,EAAE,+BAA+BO,QAAQC,OAAQtB,EAAKkB,SAASK,KAAK,iBAAiBI,GAAUH,SAE/FV,EAAE,gCAAmCgB,IAAI9B,EAAKY,KAAKI,OACnDF,EAAE,+BAAmCgB,IAAI9B,EAAKY,KAAKmB,MACnDjB,EAAE,gCAAmCgB,IAAI9B,EAAKY,KAAKoB,OACnDlB,EAAE,+BAAmCgB,IAAI9B,EAAKY,KAAKqB,MACnDnB,EAAE,kCAAmCgB,IAAI9B,EAAKY,KAAKC,SAEnDC,EAAE,6BAA6BoB,KAAKlC,EAAKY,KAAKI,OAC9CF,EAAE,4BAA6BoB,KAAKlC,EAAKY,KAAKmB,MAC9CjB,EAAE,6BAA6BoB,KAAKlC,EAAKY,KAAKoB,OAE3ChC,EAAKC,GAAGkC,OAEVrB,EAAE,+BAA+BoB,KAAKlC,EAAKC,GAAGkC,MAAM5B,MAAM,KAAK,IAAMP,EAAKC,GAAGkC,OAG9EnC,EAAKoC,QACE,GAGRpC,EAAKqC,SAAS,SAASC,EAAIC,GAG1B,GAAGA,EAAIC,MAQN,MANA1B,GAAE,gCAAgCoB,KAAMK,EAAIC,YAEpC,WAALF,GACFtC,EAAKyB,KAAK,SAMZ,IAAIgB,GAAK,SAAS7B,GAEjB,GAAIF,GAAE,EAEN,KAAIgC,IAAK9B,GAERF,EAAEA,EAAE,IAAIgC,EAAE,IAAI9B,EAAK8B,EAGjB1C,GAAKC,GAAU,MAEjBD,EAAKyB,KAAK,SAGRzB,EAAKC,GAAG,cAE8B,KAArCD,EAAKC,GAAG,YAAYK,QAAQ,OAAeI,EAAE,IAAIA,GACpDR,OAAOC,SAASC,KAAKJ,EAAKC,GAAG,YAAYS,GASnC,SAAL4B,EACFtC,EAAKyB,KAAK,SAGH,SAALa,GACFtC,EAAKY,KAAKC,QAAQ0B,EAAI1B,QACtBb,EAAKyB,KAAK,UACVX,EAAEC,OAAO,cAAcf,EAAKY,KAAKC,SAAU8B,QAAS,GAAKC,KAAM,MAC/DH,GAAMI,EAAE7C,EAAKY,KAAKC,WAGX,UAALyB,EACFtC,EAAKyB,KAAK,WAGH,WAALa,GACFtC,EAAKY,KAAKmB,KAAKQ,EAAIR,KACnB/B,EAAKyB,KAAK,UACVgB,GAAMI,EAAE7C,EAAKY,KAAKC,WAGX,SAALyB,IACc,UAAbC,EAAIO,SAEN9C,EAAKY,KAAKmB,KAAKQ,EAAIR,MAAQ/B,EAAKY,KAAKmB,KACrC/B,EAAKY,KAAKoB,MAAMO,EAAIP,OAAShC,EAAKY,KAAKoB,MACvChC,EAAKyB,KAAK,UAGK,UAAbc,EAAIO,UAEN9C,EAAKY,KAAKmB,KAAKQ,EAAIR,MAAQ/B,EAAKY,KAAKmB,KACrC/B,EAAKY,KAAKoB,MAAMO,EAAIP,OAAShC,EAAKY,KAAKoB,MACvChC,EAAKyB,KAAK,YAKbzB,EAAK+C,OAAO,SAAST,GAGpBxB,EAAE,gCAAgCoB,KAAK,GAEvC,IAAIlB,GAAMF,EAAE,gCAAgCgB,MACxCC,EAAMjB,EAAE,+BAAgCgB,MACxCE,EAAMlB,EAAE,gCAAgCgB,MACxCG,EAAMnB,EAAE,+BAAgCgB,KAE5C,OAAQ,QAALQ,GACFxB,EAAEkC,KAAMhD,EAAKiB,QAAQ,UACpBc,KAAOA,EAAKC,MAAQA,EAAMC,KAAOA,GAChC,SAAS1C,EAAE0D,EAAEC,GAAG,MAAOlD,GAAKqC,SAAS,OAAO9C,EAAE0D,EAAEC,IAAK,SAChD,GAGA,SAALZ,GACFxB,EAAE,SAASiC,SACXjC,EAAEkC,KAAMhD,EAAKiB,QAAQ,SACpBc,KAAOA,EAAKE,KAAOA,GAClB,SAAS1C,EAAE0D,EAAEC,GAAG,MAAOlD,GAAKqC,SAAS,QAAQ9C,EAAE0D,EAAEC,IAAK,SACjD,GAGA,UAALZ,GACFxB,EAAEkC,KAAMhD,EAAKiB,QAAQ,UACpBe,MAAQA,EAAMC,KAAOA,GACpB,SAAS1C,EAAE0D,EAAEC,GAAG,MAAOlD,GAAKqC,SAAS,SAAS9C,EAAE0D,EAAEC,IAAK,SAClD,GAGA,SAALZ,GACFxB,EAAEkC,KAAMhD,EAAKiB,QAAQ,SACpBD,MAAQA,GACP,SAASzB,EAAE0D,EAAEC,GAAG,MAAOlD,GAAKqC,SAAS,QAAQ9C,EAAE0D,EAAEC,IAAK,SACjD,GAGA,WAALZ,GACFxB,EAAEkC,KAAMhD,EAAKiB,QAAQ,WACpBJ,QAAWb,EAAKY,KAAKC,SAAW,IAC/B,SAAStB,EAAE0D,EAAEC,GAAG,MAAOlD,GAAKqC,SAAS,UAAU9C,EAAE0D,EAAEC,IAAK,SACnD,GAJR,QAQDlD,EAAKmD,cAAc,SAASC,GAwB3B,MAtBGpD,GAAKC,GAAU,MAMfC,OAAOC,SAASC,KAJfgD,EAEmC,KAAlCpD,EAAKC,GAAU,MAAEK,QAAQ,KAENN,EAAKC,GAAU,MAAE,YAAYD,EAAKY,KAAKC,QAIvCb,EAAKC,GAAU,MAAE,YAAYD,EAAKY,KAAKC,QAKxCb,EAAKC,GAAU,MAAE,UAKvCD,EAAKyB,KAAK,WAEJ,GAGRzB,EAAKoC,KAAK,WACTtB,EAAE,sCAAyCuC,IAAI,SAASC,GAAG,QAAQ,WAAW,MAAOtD,GAAKyB,KAAK,UAC/FX,EAAE,uCAAyCuC,IAAI,SAASC,GAAG,QAAQ,WAAW,MAAOtD,GAAKyB,KAAK,WAC/FX,EAAE,wCAAyCuC,IAAI,SAASC,GAAG,QAAQ,WAAW,MAAOtD,GAAKyB,KAAK,YAE/FX,EAAE,uCAAyCuC,IAAI,SAASC,GAAG,QAAQ,WAAW,MAAOtD,GAAK+C,OAAO,WACjGjC,EAAE,sCAAyCuC,IAAI,SAASC,GAAG,QAAQ,WAAW,MAAOtD,GAAK+C,OAAO,UACjGjC,EAAE,wCAAyCuC,IAAI,SAASC,GAAG,QAAQ,WAAW,MAAOtD,GAAK+C,OAAO,YACjGjC,EAAE,uCAAyCuC,IAAI,SAASC,GAAG,QAAQ,WAAW,MAAOtD,GAAK+C,OAAO,WACjGjC,EAAE,yCAAyCuC,IAAI,SAASC,GAAG,QAAQ,WAAW,MAAOtD,GAAK+C,OAAO,aAEjGjC,EAAE,kCAAkCuC,IAAI,SAASC,GAAG,QAAQ,WAAW,MAAOtD,GAAKmD,eAAc,KACjGrC,EAAE,+BAAkCuC,IAAI,SAASC,GAAG,QAAQ,WAAW,MAAOtD,GAAKmD,eAAc,KAGjGrC,EAAE,uBAAuBuC,IAAI,YAAYC,GAAG,WAAW,SAASC,GAC/D,MAAc,KAAXA,EAAEC,OAEJ1C,EAAE2C,MAAMC,OACR5C,EAAE,iCAAiCY,SAC5B,GAJR,UAUF1B,EAAKkB,SAASyC,KAAK,gBAAgB3D,EAAKmB,MAEjCnB","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\nvar ls=function(a) { console.log(util.inspect(a,{depth:null})); }\n\nexports.setup=function(opts){\n\n\tvar join={opts:opts};\n\t\n//\tvar $=require(\"./jquery.js\"); require(\"./jquery.cookie.js\");\n\n// parse query string\n\tjoin.qs={};\n\tvar qs=window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');\n\tfor(var i = 0; i < qs.length; i++)\n\t{\n\t\tvar q=qs[i].split(\"=\");\n\t\tjoin.qs[ q[0] ]=decodeURIComponent(q[1]);\n\t}\n\t\n\tjoin.vars={};\n\tjoin.vars.session=q.session || $.cookie(\"fud_session\");\n\tjoin.vars.token=q.token;\n\n//\trequire('./join.html.js').setup(join);\n\n/*\n\nhandle a dumid login to an external site\nfirst we get the user to login (possibly already logged in)\nthen we ask the user if they want the external site to know their info\nthen we redirect back to the external site\n\n*/\n\tjoin.userapi=\"http://api.wetgenes.com:1408/genes/user/\";\n//\tjoin.userapi=\"http://host.local:1408/genes/user/\";\n\n\tjoin.template=$(\"<div></div>\");\n\t\t\n\tjoin.fill=function(){\n\t\t$(opts.div).empty().append( join.template.find(\".wetjoin_main\").clone() );\n\n//\t\tconsole.log(join.qs);\n\t\tif(join.qs.token)\n\t\t{\n\t\t\tjoin.vars.token=join.qs.token;\n\t\t\tjoin.page(\"token\");\n\t\t\t$(\".wetjoin_main .wetjoin_submit\").click();\n\t\t}\n\t\telse\n//\t\tif(join.qs.dumid)\n\t\t{\n\t\t\tjoin.page(\"session\");\n\t\t\t$(\".wetjoin_main .wetjoin_submit\").click();\n//\t\t\tjoin.page(\"dumid\");\n\t\t}\n//\t\telse\n//\t\t{\n//\t\t\tjoin.page(\"login\");\n//\t\t}\n\n\t};\n\n\tjoin.page=function(pagename){\n\t\t\n\t\t$(\".wetjoin\").removeClass().addClass(\"wetjoin wetjoin_page_\"+pagename);\n\t\t\n\t\tjoin.vars.token=  $(\".wetjoin_main .wetjoin_token\").val()   || join.vars.token;\n\t\tjoin.vars.name=   $(\".wetjoin_main .wetjoin_name\" ).val()   || join.vars.name;\n\t\tjoin.vars.email=  $(\".wetjoin_main .wetjoin_email\").val()   || join.vars.email;\n\t\tjoin.vars.pass=   $(\".wetjoin_main .wetjoin_pass\" ).val()   || join.vars.pass;\n\t\tjoin.vars.session=$(\".wetjoin_main .wetjoin_session\").val() || join.vars.session;\n\n\t\t$(\".wetjoin_main .wetjoin_page\").empty().append( join.template.find(\".wetjoin_page_\"+pagename).clone() );\n\n\t\t$(\".wetjoin_main .wetjoin_token\"   ).val(join.vars.token);\n\t\t$(\".wetjoin_main .wetjoin_name\"    ).val(join.vars.name);\n\t\t$(\".wetjoin_main .wetjoin_email\"   ).val(join.vars.email);\n\t\t$(\".wetjoin_main .wetjoin_pass\"    ).val(join.vars.pass);\n\t\t$(\".wetjoin_main .wetjoin_session\" ).val(join.vars.session);\n\t\t\n\t\t$(\".wetjoin_main .span_token\").text(join.vars.token);\n\t\t$(\".wetjoin_main .span_name\" ).text(join.vars.name);\n\t\t$(\".wetjoin_main .span_email\").text(join.vars.email);\n\n\t\tif(join.qs.dumid)\n\t\t{\n\t\t\t$(\".wetjoin_main .span_website\").text(join.qs.dumid.split(\"/\")[2] || join.qs.dumid);\n\t\t}\n\n\t\tjoin.bind();\n\t\treturn false;\n\t};\n\n\tjoin.callback=function(cmd,dat){\n//\t\tconsole.log(cmd,dat);\n\t\t\n\t\tif(dat.error)\n\t\t{\n\t\t\t$(\".wetjoin_main .wetjoin_error\").text( dat.error );\n\n\t\t\tif(cmd==\"session\"){\n\t\t\t\tjoin.page(\"login\");\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar cont=function(vars){\n\t\t\t\n\t\t\tvar q=\"\"\n\t\t\t\n\t\t\tfor(n in vars)\n\t\t\t{\n\t\t\t\tq=q+\"&\"+n+\"=\"+vars[n];\n\t\t\t}\n\t\t\t\n\t\t\tif(join.qs[\"dumid\"])\n\t\t\t{\n\t\t\t\tjoin.page(\"dumid\");\n\t\t\t}\n\t\t\telse\n\t\t\tif(join.qs[\"continue\"])\n\t\t\t{\n\t\t\t\tif(join.qs[\"continue\"].indexOf('?') === -1) { q=\"?\"+q; }\n\t\t\t\twindow.location.href=join.qs[\"continue\"]+q;\n\t\t\t}\n//\t\t\telse\n//\t\t\t{\n//\t\t\t\twindow.location.href=\"http://forum.wetgenes.com/?\"+q;\n//\t\t\t}\n\t\t}\n\t\t\t\n\n\t\tif(cmd==\"join\"){\n\t\t\tjoin.page(\"join2\");\n\t\t}\n\t\telse\n\t\tif(cmd==\"login\"){\n\t\t\tjoin.vars.session=dat.session;\n\t\t\tjoin.page(\"login2\");\n\t\t\t$.cookie(\"fud_session\",join.vars.session,{ expires: 7*7, path: '/' });\n\t\t\tcont({S:join.vars.session});\n\t\t}\n\t\telse\n\t\tif(cmd==\"forgot\"){\n\t\t\tjoin.page(\"forgot2\");\n\t\t}\n\t\telse\n\t\tif(cmd==\"session\"){\n\t\t\tjoin.vars.name=dat.name; // remember name\n\t\t\tjoin.page(\"login2\");\n\t\t\tcont({S:join.vars.session});\n\t\t}\n\t\telse\n\t\tif(cmd==\"token\"){\n\t\t\tif(dat.command==\"update\")\n\t\t\t{\n\t\t\t\tjoin.vars.name=dat.name || join.vars.name; // remember name\n\t\t\t\tjoin.vars.email=dat.email || join.vars.email; // remember name\n\t\t\t\tjoin.page(\"login\");\n\t\t\t}\n\t\t\telse\n\t\t\tif(dat.command==\"create\")\n\t\t\t{\n\t\t\t\tjoin.vars.name=dat.name || join.vars.name; // remember name\n\t\t\t\tjoin.vars.email=dat.email || join.vars.email; // remember name\n\t\t\t\tjoin.page(\"login\");\n\t\t\t}\n\t\t}\n\t};\n\n\tjoin.submit=function(cmd){\n//\t\tconsole.log(cmd);\n\n\t\t$(\".wetjoin_main .wetjoin_error\").text(\"\");\n\n\t\tvar token=$(\".wetjoin_main .wetjoin_token\").val();\n\t\tvar name= $(\".wetjoin_main .wetjoin_name\" ).val();\n\t\tvar email=$(\".wetjoin_main .wetjoin_email\").val();\n\t\tvar pass= $(\".wetjoin_main .wetjoin_pass\" ).val();\n\n\t\tif(cmd==\"join\"){\n\t\t\t$.post( join.userapi+\"create\",{\n\t\t\t\t\"name\":name,\"email\":email,\"pass\":pass\n\t\t\t},function(a,b,c){return join.callback(\"join\",a,b,c);},\"json\");\n\t\t\treturn false;\n\t\t}\n\t\telse\n\t\tif(cmd==\"login\"){\n\t\t\t$('#form').submit();\n\t\t\t$.post( join.userapi+\"login\",{\n\t\t\t\t\"name\":name,\"pass\":pass\n\t\t\t},function(a,b,c){return join.callback(\"login\",a,b,c);},\"json\");\n\t\t\treturn true;\n\t\t}\n\t\telse\n\t\tif(cmd==\"forgot\"){\n\t\t\t$.post( join.userapi+\"update\",{\n\t\t\t\t\"email\":email,\"pass\":pass\n\t\t\t},function(a,b,c){return join.callback(\"forgot\",a,b,c);},\"json\");\n\t\t\treturn false;\n\t\t}\n\t\telse\n\t\tif(cmd==\"token\"){\n\t\t\t$.post( join.userapi+\"token\",{\n\t\t\t\t\"token\":token\n\t\t\t},function(a,b,c){return join.callback(\"token\",a,b,c);},\"json\");\n\t\t\treturn false;\n\t\t}\n\t\telse\n\t\tif(cmd==\"session\"){\n\t\t\t$.post( join.userapi+\"session\",{\n\t\t\t\t\"session\":(join.vars.session || \"\")\n\t\t\t},function(a,b,c){return join.callback(\"session\",a,b,c);},\"json\");\n\t\t\treturn false;\n\t\t}\n\t};\n\t\n\tjoin.dumid_confirm=function(confirm)\n\t{\n\t\tif(join.qs[\"dumid\"])\n\t\t{\n\t\t\tif(confirm)\n\t\t\t{\n\t\t\t\tif(join.qs[\"dumid\"].indexOf('?') === -1)\n\t\t\t\t{\n\t\t\t\t\twindow.location.href=join.qs[\"dumid\"]+\"?confirm=\"+join.vars.session;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\twindow.location.href=join.qs[\"dumid\"]+\"&confirm=\"+join.vars.session;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.location.href=join.qs[\"dumid\"]+\"&deny=1\";\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tjoin.page(\"login2\");\n\t\t}\n\t\treturn false;\n\t};\n\n\tjoin.bind=function(){\n\t\t$(\".wetjoin_main .wetjoin_header_join\"   ).off(\"click\").on(\"click\",function(){return join.page(\"join\");});\n\t\t$(\".wetjoin_main .wetjoin_header_login\"  ).off(\"click\").on(\"click\",function(){return join.page(\"login\");});\n\t\t$(\".wetjoin_main .wetjoin_header_forgot\" ).off(\"click\").on(\"click\",function(){return join.page(\"forgot\");});\n\n\t\t$(\".wetjoin_main .wetjoin_submit_login\"  ).off(\"click\").on(\"click\",function(){return join.submit(\"login\");});\n\t\t$(\".wetjoin_main .wetjoin_submit_join\"   ).off(\"click\").on(\"click\",function(){return join.submit(\"join\");});\n\t\t$(\".wetjoin_main .wetjoin_submit_forgot\" ).off(\"click\").on(\"click\",function(){return join.submit(\"forgot\");});\n\t\t$(\".wetjoin_main .wetjoin_submit_token\"  ).off(\"click\").on(\"click\",function(){return join.submit(\"token\");});\n\t\t$(\".wetjoin_main .wetjoin_submit_session\").off(\"click\").on(\"click\",function(){return join.submit(\"session\");});\n\n\t\t$(\".wetjoin_main .wetjoin_confirm\").off(\"click\").on(\"click\",function(){return join.dumid_confirm(true);});\n\t\t$(\".wetjoin_main .wetjoin_deny\"   ).off(\"click\").on(\"click\",function(){return join.dumid_confirm(false);});\n\n\t\t// enter in inputs will auto force a submit\n\t\t$(\".wetjoin_main input\").off(\"keypress\").on(\"keypress\",function(e){\n\t\t\tif(e.which == 13)\n\t\t\t{\n\t\t\t\t$(this).blur();\n\t\t\t\t$(\".wetjoin_main .wetjoin_submit\").click();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t};\n\t\n\n\tjoin.template.load(\"template.html\",join.fill);\n\t\n\treturn join;\n\n};\n"]}